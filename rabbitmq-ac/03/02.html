<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用交换器和队列 | MQ 系列教程（笔记）</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="MQ 系列教程学习笔记">
    <link rel="preload" href="/mq-tutorial/assets/css/0.styles.172db5bd.css" as="style"><link rel="preload" href="/mq-tutorial/assets/js/app.fccc8b77.js" as="script"><link rel="preload" href="/mq-tutorial/assets/js/2.69dbb0e8.js" as="script"><link rel="preload" href="/mq-tutorial/assets/js/10.48a73447.js" as="script"><link rel="preload" href="/mq-tutorial/assets/js/5.8981dd5c.js" as="script"><link rel="prefetch" href="/mq-tutorial/assets/js/11.1c3dec41.js"><link rel="prefetch" href="/mq-tutorial/assets/js/12.2330206e.js"><link rel="prefetch" href="/mq-tutorial/assets/js/13.cd520efb.js"><link rel="prefetch" href="/mq-tutorial/assets/js/14.6a4b32b8.js"><link rel="prefetch" href="/mq-tutorial/assets/js/15.8a7cfdec.js"><link rel="prefetch" href="/mq-tutorial/assets/js/16.d397de71.js"><link rel="prefetch" href="/mq-tutorial/assets/js/17.1a879f70.js"><link rel="prefetch" href="/mq-tutorial/assets/js/18.9214e1ad.js"><link rel="prefetch" href="/mq-tutorial/assets/js/19.25151ad1.js"><link rel="prefetch" href="/mq-tutorial/assets/js/20.25449e14.js"><link rel="prefetch" href="/mq-tutorial/assets/js/21.d7b2f119.js"><link rel="prefetch" href="/mq-tutorial/assets/js/22.cd699d61.js"><link rel="prefetch" href="/mq-tutorial/assets/js/23.ed2d7edb.js"><link rel="prefetch" href="/mq-tutorial/assets/js/24.c1dabc94.js"><link rel="prefetch" href="/mq-tutorial/assets/js/25.93f9e52b.js"><link rel="prefetch" href="/mq-tutorial/assets/js/26.1229fbbe.js"><link rel="prefetch" href="/mq-tutorial/assets/js/27.28d8d025.js"><link rel="prefetch" href="/mq-tutorial/assets/js/28.fdf6967b.js"><link rel="prefetch" href="/mq-tutorial/assets/js/29.17cf9046.js"><link rel="prefetch" href="/mq-tutorial/assets/js/3.6c91dad7.js"><link rel="prefetch" href="/mq-tutorial/assets/js/30.e6e0e489.js"><link rel="prefetch" href="/mq-tutorial/assets/js/31.c0ddc735.js"><link rel="prefetch" href="/mq-tutorial/assets/js/32.b7c34b84.js"><link rel="prefetch" href="/mq-tutorial/assets/js/33.89168609.js"><link rel="prefetch" href="/mq-tutorial/assets/js/34.054e64a8.js"><link rel="prefetch" href="/mq-tutorial/assets/js/35.e6bf56ed.js"><link rel="prefetch" href="/mq-tutorial/assets/js/36.bb0253c4.js"><link rel="prefetch" href="/mq-tutorial/assets/js/37.8be0005d.js"><link rel="prefetch" href="/mq-tutorial/assets/js/38.d09f952d.js"><link rel="prefetch" href="/mq-tutorial/assets/js/39.59e1ba94.js"><link rel="prefetch" href="/mq-tutorial/assets/js/4.b94a031d.js"><link rel="prefetch" href="/mq-tutorial/assets/js/40.1f94011a.js"><link rel="prefetch" href="/mq-tutorial/assets/js/41.bf0e5a2a.js"><link rel="prefetch" href="/mq-tutorial/assets/js/42.8a84461a.js"><link rel="prefetch" href="/mq-tutorial/assets/js/43.e3d0ef27.js"><link rel="prefetch" href="/mq-tutorial/assets/js/6.88db02fa.js"><link rel="prefetch" href="/mq-tutorial/assets/js/7.07ac47e8.js"><link rel="prefetch" href="/mq-tutorial/assets/js/8.ec1d24c2.js"><link rel="prefetch" href="/mq-tutorial/assets/js/9.2af0fa3d.js">
    <link rel="stylesheet" href="/mq-tutorial/assets/css/0.styles.172db5bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mq-tutorial/" class="home-link router-link-active"><!----> <span class="site-name">MQ 系列教程（笔记）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mq-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mq-tutorial/rabbitmq-ac/" class="nav-link router-link-active">
  RabbitMq 实战指南
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mq-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mq-tutorial/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mq-tutorial/rabbitmq-ac/" class="nav-link router-link-active">
  RabbitMq 实战指南
</a></div><div class="nav-item"><a href="https://github.com/zq99299/repository-summary" target="_blank" rel="noopener noreferrer" class="nav-link external">
  笔记精选汇总
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/zq99299/mq-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/mq-tutorial/rabbitmq-ac/" aria-current="page" class="sidebar-link">RabbitMq 实战指南</a></li><li><a href="/mq-tutorial/rabbitmq-ac/01/" class="sidebar-link">RabbitMQ 简介</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>相关概念介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>客户端开发向导</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mq-tutorial/rabbitmq-ac/" aria-current="page" class="sidebar-link">RabbitMq 实战指南</a></li><li><a href="/mq-tutorial/rabbitmq-ac/03/01.html" class="sidebar-link">连接 RabbitMQ</a></li><li><a href="/mq-tutorial/rabbitmq-ac/03/02.html" aria-current="page" class="active sidebar-link">使用交换器和队列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#exchangedeclare-方法详解" class="sidebar-link">exchangeDeclare 方法详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#exchangedeclarenowait" class="sidebar-link">exchangeDeclareNoWait</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#exchangedeclarepassive" class="sidebar-link">exchangeDeclarePassive</a></li></ul></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#exchangedelete-方法详解" class="sidebar-link">exchangeDelete 方法详解</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#queuedeclare-方法详解" class="sidebar-link">queueDeclare 方法详解</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#queuedelete-方法详解" class="sidebar-link">queueDelete 方法详解</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#queuebind-方法详解" class="sidebar-link">queueBind 方法详解</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#exchangebind" class="sidebar-link">exchangeBind</a></li><li class="sidebar-sub-header"><a href="/mq-tutorial/rabbitmq-ac/03/02.html#何时创建" class="sidebar-link">何时创建</a></li></ul></li><li><a href="/mq-tutorial/rabbitmq-ac/03/03.html" class="sidebar-link">发送消息</a></li><li><a href="/mq-tutorial/rabbitmq-ac/03/04.html" class="sidebar-link">消费消息</a></li><li><a href="/mq-tutorial/rabbitmq-ac/03/05.html" class="sidebar-link">消费端的确认与拒绝</a></li><li><a href="/mq-tutorial/rabbitmq-ac/03/06.html" class="sidebar-link">关闭连接</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RabbitMQ 进阶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RabbitMQ 管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RabbitMQ 配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RRabbitMQ 运维</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用交换器和队列"><a href="#使用交换器和队列" class="header-anchor">#</a> 使用交换器和队列</h1> <p>交换器和队列再 AMQP 中高层面的构建模块，应用程序需确保在使用他们的时候，就已经存在了，在使用之前需要先声明（declare）他们</p> <p>创建临时队列：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> queue <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面创建一个持久化的、绑定类型为 direct 的交换器，同时也创建了一个非持久化的、排他的、自动删除的队列（队列名称由  RabbitMQ 自动生成）。这里交换器和队列没有设置特殊的参数。</p> <p>上面展示了：如何使用路由键将队列和交换器绑定起来。上面自动生成的队列具有特性：在在该 Connection 可用，同一个 Connection 的不同 Channel 可共用，在 Connection 断开时，会自动删除该队列。</p> <p>想要在应用中共享一个队列，可用创建持久化队列</p> <p>创建持久化队列：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>分配一个固定的队列名称，并设置持久化、非排他的、非自动删除的队列。</p> <p><strong>生产者和消费者都可以声明一个交换器或则队列</strong>，如果尝试声明一个已经存在的交换器或队列（只要声明的参数完全匹配已存在的交换器或队列），RabbitMQ 则什么都不做，直接返回成功。<strong>如果参数不匹配则会抛出异常</strong>。</p> <h2 id="exchangedeclare-方法详解"><a href="#exchangedeclare-方法详解" class="header-anchor">#</a> exchangeDeclare 方法详解</h2> <p>声明创建一个交换器</p> <p>该方法有多个重载方法，都是由转调下面这个方法的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Exchange</span><span class="token punctuation">.</span><span class="token class-name">DeclareOk</span> <span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> type<span class="token punctuation">,</span>
                                          <span class="token keyword">boolean</span> durable<span class="token punctuation">,</span>
                                          <span class="token keyword">boolean</span> autoDelete<span class="token punctuation">,</span>
                                          <span class="token keyword">boolean</span> internal<span class="token punctuation">,</span>
                                          <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>返回 Exchange.DeclareOk 标识成功声明了一个交换器</p> <ul><li><p>exchange：交换器名称</p></li> <li><p>type：交换器类型；常见的有：fanout、direct、topic...</p> <p><code>com.rabbitmq.client.BuiltinExchangeType</code> 类定义了交换器类型</p></li> <li><p>durable：是否持久化</p> <p>持久化将交换器存盘，服务重启时不会丢失相关信息</p></li> <li><p>autoDelete：是否自动删除</p> <p>自动删除的前提是：<strong>至少有一个队列或则交换器与这个交换器绑定，之后所有与这个交换器绑定的队列或则交换器都与此解绑</strong>。</p> <p>**注意：**这里自动删除，不是当连接断开时，自动删除这个交换器。</p> <p>确定是这个意思吗？看 API 描述，当服务器不使用时自动删除</p></li> <li><p>internal：是否内置的</p> <p>如果是内置的交换器，<strong>客户端程序无法直接发送消息到这个交换器</strong> 中，<strong>只能通过交换器路由</strong> 到交换器这种方式。</p></li> <li><p>arguments：其他一些结构化参数</p> <p>第 4 章会讲解</p></li></ul> <h3 id="exchangedeclarenowait"><a href="#exchangedeclarenowait" class="header-anchor">#</a> exchangeDeclareNoWait</h3> <p>还有一个与之对应的  noWait 的方法</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>    void exchangeDeclareNoWait<span class="token punctuation">(</span>String exchange,
        BuiltinExchangeType type,
        boolean durable,
        boolean autoDelete,
        boolean internal,
        Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> arguments<span class="token punctuation">)</span> throws IOException<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>nowait 参数是 AMQP 中 <code>Exchange.Declare</code> 命令的参数，意思是不需要服务器返回，注意该参数的返回值是 void。</p> <p>考虑一个场景：在声明完一个交换器后（实际服务器还未完成交换器的创建），那么此时客户端就使用这个交换器，必然会发生异常。所以，如果没有特殊的应用场景，不建议使用该方法。</p> <h3 id="exchangedeclarepassive"><a href="#exchangedeclarepassive" class="header-anchor">#</a> exchangeDeclarePassive</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">Exchange</span><span class="token punctuation">.</span><span class="token class-name">DeclareOk</span> <span class="token function">exchangeDeclarePassive</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>用来监测交换器是否存在。如果不存在则抛出异常 <code>404 channel exception</code>，同时 Channel 也会被关闭</p> <h2 id="exchangedelete-方法详解"><a href="#exchangedelete-方法详解" class="header-anchor">#</a> exchangeDelete 方法详解</h2> <p>删除交换器</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">exchangeDeleteNoWait</span><span class="token punctuation">(</span><span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ifUnused<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>exchange：交换器名称</li> <li>isUnused：设置为 true ，则只有交换器没有被使用时，才被删除。</li></ul> <h2 id="queuedeclare-方法详解"><a href="#queuedeclare-方法详解" class="header-anchor">#</a> queueDeclare 方法详解</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Queue</span><span class="token punctuation">.</span><span class="token class-name">DeclareOk</span> <span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token keyword">boolean</span> durable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> exclusive<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoDelete<span class="token punctuation">,</span>
                             <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">queueDeclareNoWait</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token keyword">boolean</span> durable<span class="token punctuation">,</span> <span class="token keyword">boolean</span> exclusive<span class="token punctuation">,</span> <span class="token keyword">boolean</span> autoDelete<span class="token punctuation">,</span>
                        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>queue：队列名称</p></li> <li><p>durable：是否持久化</p></li> <li><p>exclusive：是否排他</p> <p>当一个队列被声明为排他队列，该队列 <strong>仅对首次声明它</strong> 的连接可见，并在连接断开时自动删除。</p> <p>这里需要注意一点：就算是持久化的，一旦连接关闭，这个排他队列也会被自动删除。</p> <p>适合场景：使用一个客户端同时发送和读取消息</p></li> <li><p>autoDelete：是否自动删除</p> <p>与交换器定义一致；</p></li> <li><p>arguments：设置队列的其他一些参数</p> <p>如 <code>x-message-ttl</code>、<code>x-expires</code>、<code>x-max-length</code>、<code>x-max-length-bytes</code>、<code>x-dead-letter-exchange</code>、<code>x-dead-letter-routing-key</code>、<code>x-max-priority</code></p></li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>生产者和消费者都可以使用 queueDeclare 声明一个队列，但是如果消费者已经在该 Channel 上订阅了另外一个队列，则无法再声明队列了，需要先取消订阅，然后将 Channel 设置为「传输」模式后，才能声明队列</p></div> <h2 id="queuedelete-方法详解"><a href="#queuedelete-方法详解" class="header-anchor">#</a> queueDelete 方法详解</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Queue</span><span class="token punctuation">.</span><span class="token class-name">DeleteOk</span> <span class="token function">queueDelete</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ifUnused<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ifEmpty<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>前面与交换器一直，ifEmpty 则表示当队列为空（队列里没有消息）时才能删除。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 清空队列中的内容，不是删除队列本身</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span><span class="token class-name">PurgeOk</span> <span class="token function">queuePurge</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="queuebind-方法详解"><a href="#queuebind-方法详解" class="header-anchor">#</a> queueBind 方法详解</h2> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Queue</span><span class="token punctuation">.</span><span class="token class-name">BindOk</span> <span class="token function">queueBind</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>queue：队列名</li> <li>exchange：交换器名称</li> <li>routingKey：用来绑定队列和交换器的路由键</li> <li>arguments：定义绑定的一些参数</li></ul> <p>还可以进行解绑</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token class-name">Queue</span><span class="token punctuation">.</span><span class="token class-name">UnbindOk</span> <span class="token function">queueUnbind</span><span class="token punctuation">(</span><span class="token class-name">String</span> queue<span class="token punctuation">,</span> <span class="token class-name">String</span> exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="exchangebind"><a href="#exchangebind" class="header-anchor">#</a> exchangeBind</h2> <p>将交换器与交换器绑定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Exchange</span><span class="token punctuation">.</span><span class="token class-name">BindOk</span> <span class="token function">exchangeBind</span><span class="token punctuation">(</span><span class="token class-name">String</span> destination<span class="token punctuation">,</span> <span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>绑定之后，消息从 source 交换器转发到 destination 交换器。示例代码如下</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;destination&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">exchangeBind</span><span class="token punctuation">(</span><span class="token string">&quot;destination&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exKey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;queue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;source&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;exKey&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;exToExDemo&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/mq-tutorial/assets/img/image-20200623185140110.7b66a0f0.png" alt="image-20200623185140110"></p> <p>其实把交换器当成了一个中间转发。</p> <p>解绑交换器与交换器的绑定</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Exchange</span><span class="token punctuation">.</span><span class="token class-name">UnbindOk</span> <span class="token function">exchangeUnbind</span><span class="token punctuation">(</span><span class="token class-name">String</span> destination<span class="token punctuation">,</span> <span class="token class-name">String</span> source<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="何时创建"><a href="#何时创建" class="header-anchor">#</a> 何时创建</h2> <p>RabbitMQ 的消息存储在队列中，交换器的使用并不真正耗费服务器的性能，而队列会。如果要衡量 RabbitMQ 当前的 QPS，只需要看队列即可。在实际业务应用中，需要对锁创建的队列的流量、内存占用及网卡占用有一个清晰的认知，预估平均值和峰值，以便在固定硬件资源的情况下进行合理有效的分配。</p> <p>按照 RabbitMQ· 官方建议，生产者和消费者都应该尝试创建（声明操作）队列。如果你的架构设计能保证队列再使用时就已经被创建好了，则不用遵循该建议。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zq99299/mq-tutorial/edit/master/docs/rabbitmq-ac/03/02.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: :</span> <span class="time">10 days ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mq-tutorial/rabbitmq-ac/03/01.html" class="prev">
        连接 RabbitMQ
      </a></span> <span class="next"><a href="/mq-tutorial/rabbitmq-ac/03/03.html">
        发送消息
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mq-tutorial/assets/js/app.fccc8b77.js" defer></script><script src="/mq-tutorial/assets/js/2.69dbb0e8.js" defer></script><script src="/mq-tutorial/assets/js/10.48a73447.js" defer></script><script src="/mq-tutorial/assets/js/5.8981dd5c.js" defer></script>
  </body>
</html>
